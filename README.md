CakePHP plugin для определения региона пользователя по IP-адресу.

Плагин написан для CakePHP версий 2.0+

Чтобы подключить плагин, необходимо в файле app/Config/bootstrap.php написать 

CakePlugin::load('Geo');

либо, если вы загружаете все плагины одновременно строкой 

CakePlugin::loadAll();

то плагин загрузится автоматически.



Плагин использует данные, предоставляемые сервисом  http://ipgeobase.ru/cgi-bin/Archive.cgi Чтобы начать пользоваться плагином. необходимо загрузить необходимые таблицы в базу данных. Это можно сделать автоматически, для этого в плагине есть все необходимые средства. Запустите консоль cake (подробнее о консоли можно прочитать тут http://book.cakephp.org/2.0/en/console-and-shells.html) и выполните команду

cake Geo.location update

Файлы автоматически скачаются на компьютер, разархивируются, создадутся необходимые таблицы в БД и лишние файлы будут удалены.



Все инструменты для определения региона пользователя по IP-адресу содержатся в модели Location.php. Чтобы определить регион, в методе контроллера необходимо загрузить модель из плагина и вызвать метод определения.

$this->loadModel('Geo.Location');

$ip_info = $this->Location->getIpInfo();
